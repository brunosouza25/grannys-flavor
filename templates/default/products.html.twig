{% extends 'base.html.twig' %}

{% block title %}{{ titlePage }}{% endblock %}

{% block body %}


    <html lang="pt-PT">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Bootstrap CSS -->


{#        <link rel="stylesheet" href="{{ asset('css/styles.css') }}">#}
        <title>Rascunho</title>
    </head>
    <body>

    <!--     barra procurar -->
    <div class="container-fluid margin-main" >
        <div class="row mt-4">
            <div class="col-2 border-primary d-none d-xl-block d-xxl-block "></div>
            <div class="col-xl-8 col-lg-10 col-md-10 col-sm-10 ">
                <div class="form-group d-flex justify-content-center py-1">
                    <input type="text" class="search-bar inputText py-1 col-12" placeholder="Pesquisar...">
                    <button type="submit" class="btn-search-div">
                        <i class="bi bi-search btn-search pt-0 mt-0"></i>
                    </button>
                    </form>
                </div>
            </div>
{#            <div class="col-lg-2 col-sm-12  d-none d-lg-block pd-0 not">#}
{#                <div class="button-group d-flex justify-content-end">#}
{#                    <button id="login" type="button" class="btn btn-dark py-2 px-4  btn-login-r">Login</button>#}
{#                    <button id="register" type="button" class="btn btn-primary px-3 btn-login-l">Register</button>#}
{#                </div>#}
{#            </div>#}
        </div>
    </div>
    <!--     fim barra -->
    <!--   Banner principal -->
    <div class="container mb-5">
        <div class="row">
            <div class="col-1 d-none d-xl-block d-xxl-block">
                <!-- linhas verticais -->
                <div class="container-linhas d-flex flex-column align-items-center ">
                    <div class="line-1 mb-4 mt-2"></div>

                    <div class="icon-1 mb-4">
                        <a class="footer-facebook" target="_blank" ><i class="bi bi-facebook text-black-50 media"></i></a>

                    </div>

                    <div class="line-2 mb-3 mt-2"></div>

                    <div class="icon-1 mb-4">
                        <a class="footer-instagram-link" target="_blank" ><i class="bi bi-instagram text-black-50 media"></i></a>
                    </div>

                    <div class="line-2 mb-3 mt-2"></div>

                    <div class="icon-1 mb-3 mt-2">
                        <a class="footer-youtube" target="_blank"><i class="bi bi-youtube text-black-50 media"></i></a>
                    </div>
                    <div class="line-1 mb-4 mt-2"></div>
                </div>
                <!-- .. -->

            </div>
            <!-- hero -->
            <div class="col-xl-10 col-lg-12 col-md-12 col-sm-12 col-12  py-2 mt-2 justify-content-center ">
                <div style="background-image:url('{% if banner1 is not empty %} {{ banner1.path }} {% endif %}');"
                     class="hero pt-2 text-light d-flex flex-column align-items-center justify-content-center ">
                    <div class="jumbotron mx-5">
                        <h1 class="display-4 font-weight-bold">
                            <b class="text-white">Explore a nossa seleção de ofertas</b>
                        </h1>
                        <p class="lead font-weight-normal">
                            <b>Aventura, Cultura, Desporto, Lazer...</b>
                        </p>
                    </div>
                    <!--         aa -->
                </div>
            </div> <!-- 12 -->
            <div class="col-1 d-none d-xl-block d-xxl-block ">
                <!-- linhas verticais -->
                <div class="container-linhas d-flex flex-column align-items-center ">
                    <div class="line-1 mb-5 mt-2"></div>

                    <div class="icon-1 mt-3 mb-5">
                        <p class="d-flex align-items-center text-rotate  ">PORTUGUÊS<i
                                    class="bi bi-caret-right-fill ms-1"></i></p>
                    </div>

                    <div class="line-2 mb-4"></div>

                    <div class="icon-1 mt-2">
                        <p class="d-flex align-items-center text-rotate ">EURO<i
                                    class="bi bi-caret-right-fill ms-1"></i></p>

                    </div>


                    <div class="line-1 mb-2 mt-2"></div>
                </div>
                <!-- .. -->
            </div>
        </div>
    </div>
    <!--Fim banner -->
    <!-- icone chat -->
    <div class="chat-ballon">
        <i class="bi bi-chat-dots"></i>
    </div>
    <!--   Titulo detalhes -->
{#    <div class="container-fluid">#}
{#        <div class="row">#}
{#            <div class="col-6  mt-2 ">#}
{#                <h4>DESTAQUES</h4>#}
{#            </div>#}
{#            <div class="col-6  mt-2">#}
{#                <div class="buttons d-flex justify-content-end">#}
{#                    <button type="button" class="prev btn btn-light border-dark text-dark btn-sm"><</button>#}
{#                    <button type="button" class="next  btn btn-dark btn-sm">></button>#}
{#                </div>#}
{#            </div>#}
{#            <div id="productsHigh" class="col-12" ></div>#}
{#        </div>#}
{#    </div>#}


    <!--     fim titulo -->
    <!--     cards produtos -->

    <div class="container-fluid  ">
        <div class="row ">
            <div class="col-3 d-none d-lg-block d-xl-block ">
                <div class="gw-sidebar">
                    <div id="gw-sidebar" class="gw-sidebar">
                        <div class="nano-content">
                            <ul class="gw-nav gw-nav-list">
                                <li class="init-un-active"> <a href="javascript:void(0)"> <span class="gw-menu-text">Navigation Menu</span> </a> </li>
                                <li class="init-arrow-down"> <a href="javascript:void(0)"> <span class="gw-menu-text">Category 1</span> <b class="gw-arrow"></b> </a>
                                    <ul class="gw-submenu">
                                        <li> <a href="javascript:void(0)">Menu 1</a> </li>
                                    </ul>
                                </li>
                                <li class="init-arrow-down"> <a href="javascript:void(0)"> <span class="gw-menu-text">Category 2</span> <b class="gw-arrow icon-arrow-up8"></b> </a>
                                    <ul class="gw-submenu">
                                        <li> <a href="javascript:void(0)">Menu 1</a> </li>
                                        <li> <a href="javascript:void(0)">Menu 2</a> </li>
                                        <li> <a href="javascript:void(0)">Menu 3</a> </li>
                                    </ul>
                                </li>
                                <li class="init-arrow-down"> <a href="javascript:void(0)"> <span class="gw-menu-text">Category 3</span> <b></b> </a>
                                    <ul class="gw-submenu">aa
                                        <li><div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                                                <label class="LBB form-check-label" for="flexCheckDefault">
                                                    Default checkbox
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="" id="flexCheckChecked" checked>
                                                <label class="form-check-label" for="flexCheckChecked">
                                                    Checked checkbox
                                                </label>
                                            </div>
                                        </li>
                                        <li> <a href="javascript:void(0)">Menu 1</a> </li>
                                        <li> <a href="javascript:void(0)">Menu 2</a> </li>
                                        <li> <a href="javascript:void(0)">Menu 3</a> </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div id="products" class="bg-grid col-xl-9 col-sm-12"></div>
        </div>

            <!--fecha row produtos principal -->
        <div id="categories" class="row">

        </div> <!-- Row Category -->
        <div class="row mt-2">
            <div class="col-12 ">
                <nav aria-label="..." class="slider-dots2">


                </nav>
                {#                <buttom  class="page-item"><a class="page-link" href="#">Prev</a></buttom> #}
                {#                <buttom class="page-item"><a class="page-link" href="#">Next</a></buttom> #}
            </div>
        </div>



    <!--             Divisoria Categorias -->
{#    <div class="row">#}
{#        <div class="col-12 border-dark my-4">#}
{#            <h5 class="section-title pt-2">#}
{#                CATEGORIAS#}
{#            </h5>#}
{#        </div>#}
{#    </div>#}
    <!--             ... -->

    <!--             row banner -->
        <div class="row mt-4 mb-4">
            <div class="col-6 d-flex align-items-center">
                <div class="img-box-2"
                     style="background-image:url('{% if banner2 is not empty %} {{ banner2.path }} {% endif %}');"></div>
            </div>


            <div class="col-6 d-flex align-items-center">
                <div class="box-img-text border-danger">
                    <h4 class="lead">STRIP IT DOWN. BUILD IT UP.</h4>
                    <h3 class="display-6"> Repairs, Upgrades & Custom Builds.</h3>
                    <p class="text-justify pp">Wether it's been a while since your last service, something isn't working
                        quite right or yout just want something a bit more fresh, and snappy, RYOT can help!</p>
                    <p class="text-justify pp">Our workshop has access to the best aftermarket parts on the market and
                        knowhow to get your gun up to peak performance. Get in contact with us or visit us at our store
                        in Silves and have a chat with us about what we can do for you.</p>
                    <p class="text-justify pp">
                        If you're looking for something a bit extra, check out uor pre-upgraded builds!
                    </p>
                    <button class="btn btn-dark px-5 rounded d-block">Saber Mais</button>
                </div>
            </div>
        </div>
    </div>
    </div>
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="{{ asset('front/vendors/jquery-3.3.1.min.js') }}"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.js"></script>

    <script>

        document.getElementById('register').addEventListener('click', function () {
            location.replace('/register_costumer');
        })
        document.getElementById('login').addEventListener('click', function () {
            location.replace('/login')
        })


        $(document).ready(function () {
            /**
             * Carregar produtos High
             */
            {#$.ajax({#}
            {#    type: "GET",#}
            {#    url: "{{ path('products') }}",#}
            {#    success: function (productsJson) {#}
            {#        const divProductsHigh = document.getElementById('productsHigh');#}
            {#        divProductsHigh.innerHTML = '';#}
            {#        //gerando os produtos#}
            {#        createProductCard(productsJson, divProductsHigh)#}

            {#        //fazendo o carrocel#}
            {#        $(`#productsHigh`).slick({#}
            {#            // dots: true,#}
            {#            rows: 1,#}
            {#            // appendDots: '.slider-dots',#}
            {#            prevArrow: '.prev',#}
            {#            nextArrow: ".next",#}
            {#            // arrows: true,#}
            {#            infinite: false,#}
            {#            slidesToScroll: 4,#}
            {#            slidesToShow: 4,#}
            {#            accessibility: true,#}
            {#            variableWidth: false,#}
            {#            focusOnSelect: false,#}
            {#            centerMode: false,#}
            {#            responsive: [#}
            {#                {#}
            {#                    breakpoint: 1200,#}
            {#                    settings: {#}
            {#                        slidesToScroll: 3,#}
            {#                        slidesToShow: 3#}
            {#                    }#}
            {#                },#}
            {#                {#}
            {#                    breakpoint: 900,#}
            {#                    settings: {#}
            {#                        slidesToScroll: 2,#}
            {#                        slidesToShow: 2#}
            {#                    }#}
            {#                },#}
            {#                {#}
            {#                    breakpoint: 600,#}
            {#                    settings: {#}
            {#                        slidesToScroll: 1,#}
            {#                        slidesToShow: 1#}
            {#                    }#}
            {#                }#}
            {#            ]#}
            {#        });#}

            {#    }#}
            {#});#}

            /**
             * Carregar categorias
             */
            {#$.ajax({#}
            {#    type: "GET",#}
            {#    url: "{{ path('admin/get_categories') }}",#}
            {#    success: function (categoriesJson) {#}
            {#        const divCategories = document.getElementById('categories');#}
            {#        divCategories.innerHTML = '';#}
            {#        createCategoryCard(categoriesJson, divCategories)#}
            {#    }#}
            {#});#}



            function getProducts(search, categoryId) {
                /**
                 * Carregar produtos gerais
                 */
                $.ajax({
                    type: "GET",
                    url: "{{ path('products') }}",
                    data: {search:search, categoryId:categoryId},
                    success: function (productsJson) {
                        var divProducts = document.getElementById('products');
                        divProducts.innerHTML = '';

                        //função que cria os cards
                        createProductCard(productsJson, divProducts)
                        // productCarousel('products', 3, 3)
                        $(`#products`).slick({
                            // dots: true,
                            rows: 3,
                            // appendDots: '.slider-dots',
                            prevArrow: '.prev',
                            nextArrow: ".next",
                            // arrows: true,
                            infinite: false,
                            slidesToScroll: 3,
                            slidesToShow: 3,
                            accessibility: true,
                            variableWidth: false,
                            focusOnSelect: false,
                            centerMode: false,
                            responsive: [
                                {
                                    breakpoint: 1000,
                                    settings: {
                                        slidesToScroll: 2,
                                        slidesToShow: 2
                                    }
                                },
                                {
                                    breakpoint: 600,
                                    settings: {
                                        slidesToScroll: 1,
                                        slidesToShow: 1,
                                        rows: 2
                                    }
                                }
                            ]
                        });

                    }
                });

            }

            function refreshSlick() {
                $('#products').slick('refresh');
            }

            getProducts('', '');

            // $(".search-bar")sghjgfh

            $(".btn-search-div").click(function () {
                $("#products").removeClass("slick-initialized slick-slider");
                getProducts($('.search-bar').val(), '');
            })


        })




        /**
         *
         * @param {int} id id tag
         * @param {int} size number of columns
         * @param {int} rows number of rows
         */
        function productCarousel(id, size, rows) {
            $(function () {

                $(`#${id}`).slick({
                    dots: true,
                    rows: rows,
                    // appendDots: '.slider-dots',
                    prevArrow: '.prev',
                    nextArrow: ".next",
                    // arrows: true,
                    infinite: false,
                    slidesToScroll: size,
                    slidesToShow: size,
                    accessibility: true,
                    variableWidth: false,
                    focusOnSelect: false,
                    centerMode: false,
                    responsive: [
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToScroll: size,
                                slidesToShow: size
                            }
                        },
                        {
                            breakpoint: 600,
                            settings: {
                                slidesToScroll: size,
                                slidesToShow: size
                            }
                        }
                    ]
                });

            });
        }

        function createProductCard(productsJson, divProducts) {
            if(productsJson == []){

                divProducts.innerHTML += `
                            <div class=" col-md-4 col-sm-12 ml-2 mb-2 " >
                                <h2>No products found</h2>
                            </div>
                        `
            }else{
                var moreTag = '';
                for (const product of productsJson) {
                    let colorDivs = '';
                    let cont = 0;

                    const imagesArray = product.gridColors;

                    if (typeof imagesArray != 'undefined') {
                        for (const image of imagesArray) {
                            if (cont >= 4) {
                                break;
                            }
                            colorDivs += `<img style='width: 25px; height: 25px; margin-right: 5px; border-radius: 50%;' src="${image.image}" alt="" class="">`;
                            cont++;
                        }
                        const quantity = imagesArray.length - cont;
                        moreTag = imagesArray.length > 4 ? `<p>mais ${quantity}</p>` : '';

                    }

                    divProducts.innerHTML +=
                            `
                            <div class="card card-size col-md-4 col-sm-12 ml-2 mb-2 shadow">
                                    <a href="{{ bo_url }}product/${product.id}">
                                    <div class="info-card d-flex justify-content-between mx-4 mt-2">
                                        <p class="text-light mt-3 px-2 py-1 rounded" style="background-color: #1c346c;">Novo</p>
                                        <p class="fx-10">
                                        <i ${product.isFavorite ? 'class="favorite bi bi-heart-fill text-danger' : 'class="favorite bi bi-suit-heart'}" data-product-id="${product.id}"></i>
                                        </p>
                                    </div>
                                    <img width="500" style="object-fit: contain;" height="200" class="card-img-top image-fit" src="${product.image}"
                                        alt="Card image cap">
                                    <div class="card-body text-dark">
                                        <span class="card-title">${product.name}</span>
                                        <h6 class="card-text card-price">${(Number(product.price)).toFixed(2)}€</h6>
                                        <p class="card-text">
                                        <small class="text-muted">${product.categoryName}</small>
                                        </p>
                                        <div class="mb-3">
                                            <div class="color-options d-flex justify-content-start rounded-3">${colorDivs} ${moreTag}</div> <!-- Exibe os círculos de imagem -->
                                        </div>
                                    </div>
                                    <div class="button-cart d-flex justify-content-center mb-3 ">
                                    <button type="button" class="btn btn-dark w-75"  ${product.stock < 1 ? 'disabled' : ''} style="${product.stock < 1 ? 'background-color: #636161;' : 'background-color:#1c346c;'} position: relative; bottom: 6px;">${product.stock === 0 ? 'Sem Estoque' : 'Cart'}</button>
                                    </div>
                                </a>
                            </div>
                        `;
                }

                $(".favorite").click(function (event) {
                    // Impede o comportamento padrão do link
                    event.preventDefault();

                    var $heartIcon = $(this);

                    if ($heartIcon.hasClass('bi-heart-fill')) {
                        $heartIcon.removeClass('bi-heart-fill text-danger').addClass('favorite bi bi-suit-heart');

                        const productId = $(this).data('product-id');
                        $.ajax({
                            type: "POST",
                            url: "{{ path('delete_favorite_product') }}",
                            data: {productId: productId},
                            success: function (data) {
                                /*Swal.fire({
                                    position: 'center',
                                    icon: 'success',
                                    title: 'Removido dos favoritos!',
                                    showConfirmButton: false,
                                    timer: 2500
                                });*/

                                $heartIcon.removeClass('favorite');

                                $heartIcon.off('click');
                            }, error: function (e) {
                                Swal.fire({
                                    position: 'center',
                                    icon: 'error',
                                    title: 'Ocorreu um erro!',
                                    showConfirmButton: false,
                                    timer: 2500
                                });
                            }
                        });

                    } else {
                        var productId = $(this).data("product-id");
                        var url = "/add_product_to_favorite/" + productId;
                        $heartIcon.removeClass('favorite bi bi-suit-heart').addClass('bi-heart-fill text-danger');
                        $.ajax({
                            url: url,
                            type: 'POST',
                            success: function (data) {
                                if (data.login) {
                                    location.replace('/login');
                                    return;
                                }

                               /* Swal.fire({
                                    position: 'center',
                                    icon: 'success',
                                    title: 'Adicionado aos favoritos!',
                                    showConfirmButton: false,
                                    timer: 2500
                                });*/

                                $heartIcon.removeClass('favorite');

                                $heartIcon.off('click');
                            },
                            error: function (e) {
                                Swal.fire({
                                    position: 'center',
                                    icon: 'error',
                                    title: 'Ocorreu um erro!',
                                    showConfirmButton: false,
                                    timer: 2500
                                });
                            }
                        });
                    }
                });
            }
            // divProducts.innerHTML += `<div class="slider-dots"></div>
        };

        function createCategory(categoriesJson, divCategories) {
            for (const category of categoriesJson) {
                divCategories.innerHTML +=
                    `<div class=" col-6 col-md-4 col-sm-4 col-lg-3 mb-4 ">
                            <img height="250" style="border-radius: 19px;" class="card-img borderborder-radius-size" src="${category.image}"
                                 alt="Card image">
                            <div class="card-img-overlay  d-flex justify-content-center align-items-end ">
                                <h5 class="card-title justify-content-end font-white">${category.name}</h5>
                            </div>
                        </div>
                    </div>`
            }

        };

        $('.dropdown-item').click(function () {
            $("#products").removeClass("slick-initialized slick-slider");

            var categoryId = $(this).data('id');
            getProducts('', categoryId)
        })

        // inicio filtro de produtos

        $(document).ready(function () {
            var nav = function () {

                $('.gw-nav > li > a').click(function () {
                    // debugger
                    var gw_nav = $('.gw-nav');
                    // gw_nav.find('li').removeClass('active');
                    // $('.gw-nav > li > ul > li').removeClass('active');

                    var checkElement = $(this).parent();
                    var ulDom = checkElement.find('.gw-submenu')[0];

                    if (ulDom == undefined) {
                        checkElement.addClass('active');
                        $('.gw-nav').find('li').find('ul:visible').slideUp();
                        return;
                    }
                    if (ulDom.style.display != 'block') {
                        // gw_nav.find('li').find('ul:visible').slideUp();
                        gw_nav.find('li.init-arrow-up').removeClass('init-arrow-up').addClass('arrow-down');
                        gw_nav.find('li.arrow-up').removeClass('arrow-up').addClass('arrow-down');
                        checkElement.removeClass('init-arrow-down');
                        checkElement.removeClass('arrow-down');
                        checkElement.addClass('arrow-up');
                        checkElement.addClass('active');
                        checkElement.find('ul').slideDown(300);
                    } else {
                        checkElement.removeClass('init-arrow-up');
                        checkElement.removeClass('arrow-up');
                        checkElement.removeClass('active');
                        checkElement.addClass('arrow-down');
                        checkElement.find('ul').slideUp(300);

                    }
                });
                $('.gw-nav > li > ul > li > a').click(function () {
                    $(this).parent().parent().parent().removeClass('active');
                    $('.gw-nav > li > ul > li').removeClass('active');
                    $(this).parent().addClass('active')
                });
            };
            nav();

            // fim filtro de produtos
        });


    </script>
    </body>
    </html>

{% endblock %}

